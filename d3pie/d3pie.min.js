/*!
* d3pie
* @author Ben Keen
* @version 30.3.2021
* @date March 11, 2017
* @repo http://github.com/benkeen/d3pie
*/

!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.d3pie=e()}(this,function(){function t(t,e){"string"==typeof(this.element=t)&&(n=t.replace(/^#/,""),this.element=document.getElementById(n));var n={};f(!0,n,s,e),this.options=n,null!==this.options.misc.cssPrefix?this.cssPrefix=this.options.misc.cssPrefix:(this.cssPrefix="p"+a+"_",a++),i(this)&&(d3.select(this.element).attr(o,"0.2.1"),c.call(this),u.call(this))}var o="d3pie",a=0,s={header:{title:{text:"",color:"#333333",fontSize:18,font:"arial"},subtitle:{text:"",color:"#666666",fontSize:14,font:"arial"},location:"top-center",titleSubtitlePadding:8},footer:{text:"",color:"#666666",fontSize:14,font:"arial",location:"left"},size:{canvasHeight:500,canvasWidth:500,pieInnerRadius:"0%",pieOuterRadius:null},data:{sortOrder:"none",ignoreSmallSegments:{enabled:!1,valueType:"percentage",value:null},smallSegmentGrouping:{enabled:!1,value:1,valueType:"percentage",label:"Other",color:"#cccccc"},content:[]},labels:{outer:{format:"label",hideWhenLessThanPercentage:null,pieDistance:30},inner:{format:"percentage",hideWhenLessThanPercentage:null},mainLabel:{color:"#333333",font:"arial",fontSize:10},percentage:{color:"#dddddd",font:"arial",fontSize:10,decimalPlaces:0},value:{color:"#cccc44",font:"arial",fontSize:10},lines:{enabled:!0,style:"curved",color:"segment"},truncation:{enabled:!1,truncateLength:30},formatter:null},effects:{load:{effect:"default",speed:1e3},pullOutSegmentOnClick:{effect:"bounce",speed:300,size:10},highlightSegmentOnMouseover:!0,highlightLuminosity:-.2},tooltips:{enabled:!1,type:"placeholder",string:"",placeholderParser:null,styles:{fadeInSpeed:250,backgroundColor:"#000000",backgroundOpacity:.5,color:"#efefef",borderRadius:2,font:"arial",fontSize:10,padding:4}},misc:{colors:{background:null,segments:["#2484c1","#65a620","#7b6888","#a05d56","#961a1a","#d8d23a","#e98125","#d0743c","#635222","#6ada6a","#0c6197","#7d9058","#207f33","#44b9b0","#bca44a","#e4a14b","#a3acb2","#8cc3e9","#69a6f9","#5b388f","#546e91","#8bde95","#d2ab58","#273c71","#98bf6e","#4daa4b","#98abc5","#cc1010","#31383b","#006391","#c2643f","#b0a474","#a5a39c","#a9c2bc","#22af8c","#7fcecf","#987ac6","#3d3b87","#b77b1c","#c9c2b6","#807ece","#8db27c","#be66a2","#9ed3c6","#00644b","#005064","#77979f","#77e079","#9c73ab","#1f79a7"],segmentStroke:"#ffffff"},gradient:{enabled:!1,percentage:95,color:"#000000"},canvasPadding:{top:5,right:5,bottom:5,left:5},pieCenterOffset:{x:0,y:0},cssPrefix:null},callbacks:{onload:null,onMouseoverSegment:null,onMouseoutSegment:null,onClickSegment:null}},i=function(t){var e=t.cssPrefix,n=t.element,o=t.options;if(!window.d3||!window.d3.hasOwnProperty("version"))return console.error("d3pie error: d3 is not available"),!1;if(!(n instanceof HTMLElement||n instanceof SVGElement))return console.error("d3pie error: the first d3pie() param must be a valid DOM element (not jQuery) or a ID string."),!1;if(!/[a-zA-Z][a-zA-Z0-9_-]*$/.test(e))return console.error("d3pie error: invalid options.misc.cssPrefix"),!1;if(!p.isArray(o.data.content))return console.error("d3pie error: invalid config structure: missing data.content property."),!1;if(0===o.data.content.length)return console.error("d3pie error: no data supplied."),!1;for(var a=[],s=0;s<o.data.content.length;s++)"number"!=typeof o.data.content[s].value||isNaN(o.data.content[s].value)?console.log("not valid: ",o.data.content[s]):o.data.content[s].value<=0?console.log("not valid - should have positive value: ",o.data.content[s]):a.push(o.data.content[s]);return t.options.data.content=a,!0},p={addSVGSpace:function(t){var e=t.element,n=t.options.size.canvasWidth,o=t.options.size.canvasHeight,a=t.options.misc.colors.background,o=d3.select(e).append("svg:svg").attr("width",n).attr("height",o).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+n+" "+o);return"transparent"!==a&&o.style("background-color",function(){return a}),o},whenIdExists:function(t,e){var n=1,o=setInterval(function(){document.getElementById(t)&&(clearInterval(o),e()),1e3<n&&clearInterval(o),n++},1)},whenElementsExist:function(n,o){var a=1,s=setInterval(function(){for(var t=!0,e=0;e<n.length;e++)if(!document.getElementById(n[e])){t=!1;break}t&&(clearInterval(s),o()),1e3<a&&clearInterval(s),a++},1)},shuffleArray:function(t){for(var e,n,o=t.length;0!==o;)n=Math.floor(Math.random()*o),e=t[--o],t[o]=t[n],t[n]=e;return t},processObj:function(t,e,n){return"string"==typeof e?p.processObj(t,e.split("."),n):1===e.length&&void 0!==n?(t[e[0]]=n,t[e[0]]):0===e.length?t:p.processObj(t[e[0]],e.slice(1),n)},getDimensions:function(t){var e=document.getElementById(t),n=0,o=0;return e?(n=(e=e.getBBox()).width,o=e.height):console.log("error: getDimensions() "+t+" not found."),{w:n,h:o}},rectIntersect:function(t,e){return!(e.x>t.x+t.w||e.x+e.w<t.x||e.y+e.h<t.y||e.y>t.y+t.h)},getColorShade:function(t,e){(t=String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;for(var n="#",o=0;o<3;o++){var a=parseInt(t.substr(2*o,2),16);n+=("00"+(a=Math.round(Math.min(Math.max(0,a+a*e),255)).toString(16))).substr(a.length)}return n},initSegmentColors:function(t){for(var e=t.options.data.content,n=t.options.misc.colors.segments,o=[],a=0;a<e.length;a++)e[a].hasOwnProperty("color")?o.push(e[a].color):o.push(n[a]);return o},applySmallSegmentGrouping:function(t,e){var n;"percentage"===e.valueType&&(n=d.getTotalPieSize(t));for(var o=[],a=[],s=0,i=0;i<t.length;i++)"percentage"===e.valueType?t[i].value/n*100<=e.value?(a.push(t[i]),s+=t[i].value):(t[i].isGrouped=!1,o.push(t[i])):t[i].value<=e.value?(a.push(t[i]),s+=t[i].value):(t[i].isGrouped=!1,o.push(t[i]));return a.length&&o.push({color:e.color,label:e.label,value:s,isGrouped:!0,groupedData:a}),o},showPoint:function(t,e,n){t.append("circle").attr("cx",e).attr("cy",n).attr("r",2).style("fill","black")},isFunction:function(t){return t&&"[object Function]"==={}.toString.call(t)},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)}},f=function(){var t,e,n,o,a,s=arguments[0]||{},i=1,r=arguments.length,l=!1,c=Object.prototype.toString,u=Object.prototype.hasOwnProperty,p={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},d={isFunction:function(t){return"function"===d.type(t)},isArray:Array.isArray||function(t){return"array"===d.type(t)},isWindow:function(t){return null!==t&&t===t.window},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},type:function(t){return null===t?String(t):p[c.call(t)]||"object"},isPlainObject:function(t){if(!t||"object"!==d.type(t)||t.nodeType)return!1;try{if(t.constructor&&!u.call(t,"constructor")&&!u.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}for(var e in t);return void 0===e||u.call(t,e)}};for("boolean"==typeof s&&(l=s,s=arguments[1]||{},i=2),"object"==typeof s||d.isFunction(s)||(s={}),r===i&&(s=this,--i);i<r;i++)if(null!==(t=arguments[i]))for(e in t)a=s[e],s!==(n=t[e])&&(l&&n&&(d.isPlainObject(n)||(o=d.isArray(n)))?(a=o?(o=!1,a&&d.isArray(a)?a:[]):a&&d.isPlainObject(a)?a:{},s[e]=f(l,a,n)):void 0!==n&&(s[e]=n));return s},d={toRadians:function(t){return t*(Math.PI/180)},toDegrees:function(t){return t*(180/Math.PI)},computePieRadius:function(t){var e=t.options.size,n=t.options.misc.canvasPadding,o=e.canvasWidth-n.left-n.right,a=e.canvasHeight-n.top-n.bottom;"pie-center"!==t.options.header.location&&(a-=t.textComponents.headerHeight),t.textComponents.footer.exists&&(a-=t.textComponents.footer.h);var s,n=(o<(a=a<0?0:a)?o:a)/3;null!==e.pieOuterRadius&&(n=/%/.test(e.pieOuterRadius)?(s=(s=99<(s=parseInt(e.pieOuterRadius.replace(/[\D]/,""),10))?99:s)<0?0:s,o=o<a?o:a,"none"===t.options.labels.outer.format||0<o-(a=2*parseInt(t.options.labels.outer.pieDistance,10))&&(o-=a),Math.floor(o/100*s)/2):parseInt(e.pieOuterRadius,10)),e=/%/.test(e.pieInnerRadius)?(s=(s=99<(s=parseInt(e.pieInnerRadius.replace(/[\D]/,""),10))?99:s)<0?0:s,Math.floor(n/100*s)):parseInt(e.pieInnerRadius,10),t.innerRadius=e,t.outerRadius=n},getTotalPieSize:function(t){for(var e=0,n=0;n<t.length;n++)e+=t[n].value;return e},sortPieData:function(t){var e=t.options.data.content;switch(t.options.data.sortOrder){case"none":break;case"random":e=p.shuffleArray(e);break;case"value-asc":e.sort(function(t,e){return t.value<e.value?-1:1});break;case"value-desc":e.sort(function(t,e){return t.value<e.value?1:-1});break;case"label-asc":e.sort(function(t,e){return t.label.toLowerCase()>e.label.toLowerCase()?1:-1});break;case"label-desc":e.sort(function(t,e){return t.label.toLowerCase()<e.label.toLowerCase()?1:-1})}return e},getPieTranslateCenter:function(t){return"translate("+t.x+","+t.y+")"},calculatePieCenter:function(t){var e=t.options.misc.pieCenterOffset,n=t.textComponents.title.exists&&"pie-center"!==t.options.header.location,o=t.textComponents.subtitle.exists&&"pie-center"!==t.options.header.location,a=t.options.misc.canvasPadding.top;n&&o?a+=t.textComponents.title.h+t.options.header.titleSubtitlePadding+t.textComponents.subtitle.h:n?a+=t.textComponents.title.h:o&&(a+=t.textComponents.subtitle.h);n=0;t.textComponents.footer.exists&&(n=t.textComponents.footer.h+t.options.misc.canvasPadding.bottom);o=(t.options.size.canvasWidth-t.options.misc.canvasPadding.left-t.options.misc.canvasPadding.right)/2+t.options.misc.canvasPadding.left,a=(t.options.size.canvasHeight-n-a)/2+a;o+=e.x,a+=e.y,t.pieCenter={x:o,y:a}},rotate:function(t,e,n,o,a){a=a*Math.PI/180;var s=Math.cos,i=Math.sin;return{x:(t-n)*s(a)-(e-o)*i(a)+n,y:(t-n)*i(a)+(e-o)*s(a)+o}},translate:function(t,e,n,o){o=d.toRadians(o);return{x:t+n*Math.sin(o),y:e-n*Math.cos(o)}},pointIsInArc:function(t,e,n){var o=n.innerRadius()(e),a=n.outerRadius()(e),s=n.startAngle()(e),n=n.endAngle()(e),e=t.x*t.x+t.y*t.y,t=(t=Math.atan2(t.x,-t.y))<0?t+2*Math.PI:t;return o*o<=e&&e<=a*a&&s<=t&&t<=n}},h={add:function(n,o,t){var e=h.getIncludes(t),a=n.options.labels,s=n.svg.insert("g","."+n.cssPrefix+"labels-"+o).attr("class",n.cssPrefix+"labels-"+o).selectAll("."+n.cssPrefix+"labelGroup-"+o).data(n.options.data.content).enter().append("g").attr("id",function(t,e){return n.cssPrefix+"labelGroup"+e+"-"+o}).attr("data-index",function(t,e){return e}).attr("class",n.cssPrefix+"labelGroup-"+o).style("opacity",0),i={section:o,sectionDisplayType:t};e.mainLabel&&s.append("text").attr("id",function(t,e){return n.cssPrefix+"segmentMainLabel"+e+"-"+o}).attr("class",n.cssPrefix+"segmentMainLabel-"+o).text(function(t,e){var n=t.label;return a.formatter?(i.index=e,i.part="mainLabel",i.value=t.value,i.label=n,n=a.formatter(i)):a.truncation.enabled&&t.label.length>a.truncation.truncateLength&&(n=t.label.substring(0,a.truncation.truncateLength)+"..."),n}).style("font-size",a.mainLabel.fontSize+"px").style("font-family",a.mainLabel.font).style("fill",a.mainLabel.color),e.percentage&&s.append("text").attr("id",function(t,e){return n.cssPrefix+"segmentPercentage"+e+"-"+o}).attr("class",n.cssPrefix+"segmentPercentage-"+o).text(function(t,e){var n=t.percentage;return a.formatter?(i.index=e,i.part="percentage",i.value=t.value,i.label=t.percentage,n=a.formatter(i)):n+="%",n}).style("font-size",a.percentage.fontSize+"px").style("font-family",a.percentage.font).style("fill",a.percentage.color),e.value&&s.append("text").attr("id",function(t,e){return n.cssPrefix+"segmentValue"+e+"-"+o}).attr("class",n.cssPrefix+"segmentValue-"+o).text(function(t,e){return i.index=e,i.part="value",i.value=t.value,i.label=t.value,a.formatter?a.formatter(i,t.value):t.value}).style("font-size",a.value.fontSize+"px").style("font-family",a.value.font).style("fill",a.value.color)},positionLabelElements:function(s,i,t){h["dimensions-"+i]=[],d3.selectAll("."+s.cssPrefix+"labelGroup-"+i).each(function(t,e){var n=d3.select(this).selectAll("."+s.cssPrefix+"segmentMainLabel-"+i),o=d3.select(this).selectAll("."+s.cssPrefix+"segmentPercentage-"+i),a=d3.select(this).selectAll("."+s.cssPrefix+"segmentValue-"+i);h["dimensions-"+i].push({mainLabel:null!==n.node()?n.node().getBBox():null,percentage:null!==o.node()?o.node().getBBox():null,value:null!==a.node()?a.node().getBBox():null})});var n=h["dimensions-"+i];switch(t){case"label-value1":d3.selectAll("."+s.cssPrefix+"segmentValue-"+i).attr("dx",function(t,e){return n[e].mainLabel.width+5});break;case"label-value2":d3.selectAll("."+s.cssPrefix+"segmentValue-"+i).attr("dy",function(t,e){return n[e].mainLabel.height});break;case"label-percentage1":d3.selectAll("."+s.cssPrefix+"segmentPercentage-"+i).attr("dx",function(t,e){return n[e].mainLabel.width+5});break;case"label-percentage2":d3.selectAll("."+s.cssPrefix+"segmentPercentage-"+i).attr("dx",function(t,e){return n[e].mainLabel.width/2-n[e].percentage.width/2}).attr("dy",function(t,e){return n[e].mainLabel.height})}},computeLabelLinePositions:function(n){n.lineCoordGroups=[],d3.selectAll("."+n.cssPrefix+"labelGroup-outer").each(function(t,e){return h.computeLinePosition(n,e)})},computeLinePosition:function(t,e){var n=g.getSegmentAngle(e,t.options.data.content,t.totalSize,{midpoint:!0}),o=d.rotate(t.pieCenter.x,t.pieCenter.y-t.outerRadius,t.pieCenter.x,t.pieCenter.y,n),a=t.outerLabelGroupData[e].h/5,s=Math.floor(n/90);switch(s=2===s&&180===n?1:s){case 0:r=t.outerLabelGroupData[e].x-6-(t.outerLabelGroupData[e].x-6-o.x)/2,l=t.outerLabelGroupData[e].y+(o.y-t.outerLabelGroupData[e].y)/4,c=t.outerLabelGroupData[e].x-6,u=t.outerLabelGroupData[e].y-a;break;case 1:r=o.x+(t.outerLabelGroupData[e].x-o.x)/4,l=o.y+(t.outerLabelGroupData[e].y-o.y)/4,c=t.outerLabelGroupData[e].x-6,u=t.outerLabelGroupData[e].y-a;break;case 2:var i=t.outerLabelGroupData[e].x+t.outerLabelGroupData[e].w+6,r=o.x-(o.x-i)/4,l=o.y+(t.outerLabelGroupData[e].y-o.y)/4,c=t.outerLabelGroupData[e].x+t.outerLabelGroupData[e].w+6,u=t.outerLabelGroupData[e].y-a;break;case 3:i=t.outerLabelGroupData[e].x+t.outerLabelGroupData[e].w+6;r=i+(o.x-i)/4,l=t.outerLabelGroupData[e].y+(o.y-t.outerLabelGroupData[e].y)/4,c=t.outerLabelGroupData[e].x+t.outerLabelGroupData[e].w+6,u=t.outerLabelGroupData[e].y-a}"straight"===t.options.labels.lines.style?t.lineCoordGroups[e]=[{x:o.x,y:o.y},{x:c,y:u}]:t.lineCoordGroups[e]=[{x:o.x,y:o.y},{x:r,y:l},{x:c,y:u}]},addLabelLines:function(o){var t=o.svg.insert("g","."+o.cssPrefix+"pieChart").attr("class",o.cssPrefix+"lineGroups").style("opacity",0).selectAll("."+o.cssPrefix+"lineGroup").data(o.lineCoordGroups).enter().append("g").attr("class",o.cssPrefix+"lineGroup"),e=d3.line().curve(d3.curveBasis).x(function(t){return t.x}).y(function(t){return t.y});t.append("path").attr("d",e).attr("stroke",function(t,e){return"segment"===o.options.labels.lines.color?o.options.colors[e]:o.options.labels.lines.color}).attr("stroke-width",1).attr("fill","none").style("opacity",function(t,e){var n=o.options.labels.outer.hideWhenLessThanPercentage;return null!==n&&o.options.data.content[e].percentage<n||""===o.options.data.content[e].label?0:1})},positionLabelGroups:function(r,l){"none"!==r.options.labels[l].format&&d3.selectAll("."+r.cssPrefix+"labelGroup-"+l).style("opacity",0).attr("transform",function(t,e){var n,o,a,s,i;return"outer"===l?(s=r.outerLabelGroupData[e].x,i=r.outerLabelGroupData[e].y):(n=f(!0,{},r.pieCenter),0<r.innerRadius&&(a=g.getSegmentAngle(e,r.options.data.content,r.totalSize,{midpoint:!0}),o=d.translate(r.pieCenter.x,r.pieCenter.y,r.innerRadius,a),n.x=o.x,n.y=o.y),o=(a=p.getDimensions(r.cssPrefix+"labelGroup"+e+"-inner")).w/2,a=a.h/4,s=n.x+(r.lineCoordGroups[e][0].x-n.x)/1.8,i=n.y+(r.lineCoordGroups[e][0].y-n.y)/1.8,s-=o,i+=a),"translate("+s+","+i+")"})},fadeInLabelsAndLines:function(o){var t="default"===o.options.effects.load.effect?o.options.effects.load.speed:1;setTimeout(function(){var t="default"===o.options.effects.load.effect?400:1;d3.selectAll("."+o.cssPrefix+"labelGroup-outer").transition().duration(t).style("opacity",function(t,e){var n=o.options.labels.outer.hideWhenLessThanPercentage;return null!==n&&t.percentage<n?0:1}),d3.selectAll("."+o.cssPrefix+"labelGroup-inner").transition().duration(t).style("opacity",function(t,e){var n=o.options.labels.inner.hideWhenLessThanPercentage;return null!==n&&t.percentage<n?0:1}),d3.selectAll("g."+o.cssPrefix+"lineGroups").transition().duration(t).style("opacity",1),p.isFunction(o.options.callbacks.onload)&&setTimeout(function(){try{o.options.callbacks.onload()}catch(t){}},t)},t)},getIncludes:function(t){var e=!1,n=!1,o=!1;switch(t){case"label":e=!0;break;case"value":n=!0;break;case"percentage":o=!0;break;case"label-value1":case"label-value2":n=e=!0;break;case"label-percentage1":case"label-percentage2":o=e=!0}return{mainLabel:e,value:n,percentage:o}},computeOuterLabelCoords:function(n){n.svg.selectAll("."+n.cssPrefix+"labelGroup-outer").each(function(t,e){return h.getIdealOuterLabelPositions(n,e)}),h.resolveOuterLabelCollisions(n)},resolveOuterLabelCollisions:function(t){var e;"none"!==t.options.labels.outer.format&&(e=t.options.data.content.length,h.checkConflict(t,0,"clockwise",e),h.checkConflict(t,e-1,"anticlockwise",e))},checkConflict:function(t,e,n,o){var a,s;if(!(o<=1)){var i=t.outerLabelGroupData[e].hs;if(!("clockwise"===n&&"right"!==i||"anticlockwise"===n&&"left"!==i)){var r="clockwise"===n?e+1:e-1,l=t.outerLabelGroupData[e],c=t.outerLabelGroupData[r],u={labelHeights:t.outerLabelGroupData[0].h,center:t.pieCenter,lineLength:t.outerRadius+t.options.labels.outer.pieDistance,heightChange:t.outerLabelGroupData[0].h+1};if("clockwise"===n){for(a=0;a<=e;a++)if(s=t.outerLabelGroupData[a],!h.isLabelHidden(t,a)&&p.rectIntersect(s,c)){h.adjustLabelPos(t,r,l,u);break}}else for(a=o-1;e<=a;a--)if(s=t.outerLabelGroupData[a],!h.isLabelHidden(t,a)&&p.rectIntersect(s,c)){h.adjustLabelPos(t,r,l,u);break}h.checkConflict(t,r,n,o)}}},isLabelHidden:function(t,e){var n=t.options.labels.outer.hideWhenLessThanPercentage;return null!==n&&t.options.data.content[e].percentage<n||""===t.options.data.content[e].label},adjustLabelPos:function(t,e,n,o){var a=n.y+o.heightChange,s=o.center.y-a,s=Math.abs(o.lineLength)>Math.abs(s)?Math.sqrt(o.lineLength*o.lineLength-s*s):Math.sqrt(s*s-o.lineLength*o.lineLength),s="right"===n.hs?o.center.x+s:o.center.x-s-t.outerLabelGroupData[e].w;t.outerLabelGroupData[e].x=s,t.outerLabelGroupData[e].y=a},getIdealOuterLabelPositions:function(t,e){var n,o,a,s=d3.select("#"+t.cssPrefix+"labelGroup"+e+"-outer").node();s&&(n=s.getBBox(),o=g.getSegmentAngle(e,t.options.data.content,t.totalSize,{midpoint:!0}),a=t.pieCenter.x,s=t.pieCenter.y-(t.outerRadius+t.options.labels.outer.pieDistance),a=d.rotate(a,s,t.pieCenter.x,t.pieCenter.y,o),s="right",180<o?(a.x-=n.width+8,s="left"):a.x+=8,t.outerLabelGroupData[e]={x:a.x,y:a.y,w:n.width,h:n.height,hs:s})}},g={effectMap:{none:d3.easeLinear,bounce:d3.easeBounce,linear:d3.easeLinear,sin:d3.easeSin,elastic:d3.easeElastic,back:d3.easeBack,quad:d3.easeQuad,circle:d3.easeCircle,exp:d3.easeExp},create:function(o){var t=o.pieCenter,a=o.options.colors,e=o.options.effects.load,n=o.options.misc.colors.segmentStroke,s=o.svg.insert("g","#"+o.cssPrefix+"title").attr("transform",function(){return d.getPieTranslateCenter(t)}).attr("class",o.cssPrefix+"pieChart"),i=d3.arc().innerRadius(o.innerRadius).outerRadius(o.outerRadius).startAngle(0).endAngle(function(t){return t.value/o.totalSize*2*Math.PI}),r=s.selectAll("."+o.cssPrefix+"arc").data(o.options.data.content).enter().append("g").attr("class",o.cssPrefix+"arc"),s=e.speed;"none"===e.effect&&(s=0),r.append("path").attr("id",function(t,e){return o.cssPrefix+"segment"+e}).attr("fill",function(t,e){var n=a[e];return n=o.options.misc.gradient.enabled?"url(#"+o.cssPrefix+"grad"+e+")":n}).attr("data-index",function(t,e){return e}).style("stroke",n).style("stroke-width",1).transition().ease(d3.easeCubicInOut).duration(s).attrTween("d",function(t){var e=d3.interpolate({value:0},t);return function(t){return o.arc(e(t))}}),o.svg.selectAll("g."+o.cssPrefix+"arc").attr("transform",function(t,e){var n=0;return"rotate("+(n=0<e?g.getSegmentAngle(e-1,o.options.data.content,o.totalSize):n)+")"}),o.arc=i},addGradients:function(n){var t=n.svg.append("defs").selectAll("radialGradient").data(n.options.data.content).enter().append("radialGradient").attr("gradientUnits","userSpaceOnUse").attr("cx",0).attr("cy",0).attr("r","120%").attr("id",function(t,e){return n.cssPrefix+"grad"+e});t.append("stop").attr("offset","0%").style("stop-color",function(t,e){return n.options.colors[e]}),t.append("stop").attr("offset",n.options.misc.gradient.percentage+"%").style("stop-color",n.options.misc.gradient.color)},addSegmentEventHandlers:function(o){var t=d3.selectAll("."+o.cssPrefix+"arc,."+o.cssPrefix+"labelGroup-inner,."+o.cssPrefix+"labelGroup-outer");t.on("click",function(){var t=d3.select(this),e=(t=t.attr("class")===o.cssPrefix+"arc"?t.select("path"):(e=t.attr("data-index"),d3.select("#"+o.cssPrefix+"segment"+e))).attr("class")===o.cssPrefix+"expanded";g.onSegmentEvent(o,o.options.callbacks.onClickSegment,t,e),"none"!==o.options.effects.pullOutSegmentOnClick.effect&&(e?g.closeSegment(o,t.node()):g.openSegment(o,t.node()))}),t.on("mouseover",function(){var t=d3.select(this),e=t.attr("class")===o.cssPrefix+"arc"?t.select("path"):(n=t.attr("data-index"),d3.select("#"+o.cssPrefix+"segment"+n));o.options.effects.highlightSegmentOnMouseover&&(n=e.attr("data-index"),t=o.options.colors[n],e.style("fill",p.getColorShade(t,o.options.effects.highlightLuminosity))),o.options.tooltips.enabled&&(n=e.attr("data-index"),l.showTooltip(o,n));var n=e.attr("class")===o.cssPrefix+"expanded";g.onSegmentEvent(o,o.options.callbacks.onMouseoverSegment,e,n)}),t.on("mousemove",function(){l.moveTooltip(o)}),t.on("mouseout",function(){var t=d3.select(this),e=t.attr("class")===o.cssPrefix+"arc"?t.select("path"):(n=t.attr("data-index"),d3.select("#"+o.cssPrefix+"segment"+n));o.options.effects.highlightSegmentOnMouseover&&(n=e.attr("data-index"),t=o.options.colors[n],o.options.misc.gradient.enabled&&(t="url(#"+o.cssPrefix+"grad"+n+")"),e.style("fill",t)),o.options.tooltips.enabled&&(n=e.attr("data-index"),l.hideTooltip(o,n));var n=e.attr("class")===o.cssPrefix+"expanded";g.onSegmentEvent(o,o.options.callbacks.onMouseoutSegment,e,n)})},onSegmentEvent:function(t,e,n,o){var a;p.isFunction(e)&&(a=parseInt(n.attr("data-index"),10),e({segment:n.node(),index:a,expanded:o,data:t.options.data.content[a]}))},openSegment:function(s,n){s.isOpeningSegment||(s.isOpeningSegment=!0,g.maybeCloseOpenSegment(s),d3.select(n).transition().ease(g.effectMap[s.options.effects.pullOutSegmentOnClick.effect]).duration(s.options.effects.pullOutSegmentOnClick.speed).attr("transform",function(t,e){var n=s.arc.centroid(t),o=n[0],a=n[1],t=Math.sqrt(o*o+a*a),n=parseInt(s.options.effects.pullOutSegmentOnClick.size,10);return"translate("+o/t*n+","+a/t*n+")"}).on("end",function(t,e){s.currentlyOpenSegment=n,s.isOpeningSegment=!1,d3.select(n).attr("class",s.cssPrefix+"expanded")}))},maybeCloseOpenSegment:function(t){0<d3.selectAll("."+t.cssPrefix+"expanded").size()&&g.closeSegment(t,d3.select("."+t.cssPrefix+"expanded").node())},closeSegment:function(n,o){d3.select(o).transition().duration(400).attr("transform","translate(0,0)").on("end",function(t,e){d3.select(o).attr("class",""),n.currentlyOpenSegment=null})},getCentroid:function(t){t=t.getBBox();return{x:t.x+t.width/2,y:t.y+t.height/2}},getSegmentAngle:function(t,e,n,o){var a=f({compounded:!0,midpoint:!1},o),s=e[t].value;if(a.compounded)for(var i=0,r=0;r<=t;r++)i+=e[r].value;o=(i=void 0===i?s:i)/n*360;return a.midpoint&&(o-=s/n*360/2),o}},r={offscreenCoord:-1e4,addTitle:function(e){e.svg.selectAll("."+e.cssPrefix+"title").data([e.options.header.title]).enter().append("text").text(function(t){return t.text}).attr("id",e.cssPrefix+"title").attr("class",e.cssPrefix+"title").attr("x",r.offscreenCoord).attr("y",r.offscreenCoord).attr("text-anchor",function(){var t="top-center"===e.options.header.location||"pie-center"===e.options.header.location?"middle":"left";return t}).attr("fill",function(t){return t.color}).style("font-size",function(t){return t.fontSize+"px"}).style("font-family",function(t){return t.font})},positionTitle:function(t){var e=t.textComponents,n=t.options.header.location,o=t.options.misc.canvasPadding,a=t.options.size.canvasWidth,s=t.options.header.titleSubtitlePadding,a="top-left"===n?o.left:(a-o.right)/2+o.left;a+=t.options.misc.pieCenterOffset.x;o=o.top+e.title.h;"pie-center"===n&&(o=t.pieCenter.y,e.subtitle.exists?o=o-(e.title.h+s+e.subtitle.h)/2+e.title.h:o+=e.title.h/4),t.svg.select("#"+t.cssPrefix+"title").attr("x",a).attr("y",o)},addSubtitle:function(t){var e=t.options.header.location;t.svg.selectAll("."+t.cssPrefix+"subtitle").data([t.options.header.subtitle]).enter().append("text").text(function(t){return t.text}).attr("x",r.offscreenCoord).attr("y",r.offscreenCoord).attr("id",t.cssPrefix+"subtitle").attr("class",t.cssPrefix+"subtitle").attr("text-anchor",function(){var t="top-center"===e||"pie-center"===e?"middle":"left";return t}).attr("fill",function(t){return t.color}).style("font-size",function(t){return t.fontSize+"px"}).style("font-family",function(t){return t.font})},positionSubtitle:function(t){var e=t.options.misc.canvasPadding,n=t.options.size.canvasWidth,n="top-left"===t.options.header.location?e.left:(n-e.right)/2+e.left;n+=t.options.misc.pieCenterOffset.x;e=r.getHeaderHeight(t);t.svg.select("#"+t.cssPrefix+"subtitle").attr("x",n).attr("y",e)},addFooter:function(e){e.svg.selectAll("."+e.cssPrefix+"footer").data([e.options.footer]).enter().append("text").text(function(t){return t.text}).attr("x",r.offscreenCoord).attr("y",r.offscreenCoord).attr("id",e.cssPrefix+"footer").attr("class",e.cssPrefix+"footer").attr("text-anchor",function(){var t="left";return"bottom-center"===e.options.footer.location?t="middle":"bottom-right"===e.options.footer.location&&(t="left"),t}).attr("fill",function(t){return t.color}).style("font-size",function(t){return t.fontSize+"px"}).style("font-family",function(t){return t.font})},positionFooter:function(t){var e=t.options.footer.location,n=t.textComponents.footer.w,o=t.options.size.canvasWidth,a=t.options.size.canvasHeight,s=t.options.misc.canvasPadding,o="bottom-left"===e?s.left:"bottom-right"===e?o-n-s.right:o/2;t.svg.select("#"+t.cssPrefix+"footer").attr("x",o).attr("y",a-s.bottom)},getHeaderHeight:function(t){var e;return t.textComponents.title.exists?(e=t.textComponents.title.h+t.options.header.titleSubtitlePadding+t.textComponents.subtitle.h,"pie-center"===t.options.header.location?t.pieCenter.y-e/2+e:e+t.options.misc.canvasPadding.top):"pie-center"===t.options.header.location?(e=t.options.misc.canvasPadding.bottom+t.textComponents.footer.h,(t.options.size.canvasHeight-e)/2+t.options.misc.canvasPadding.top+t.textComponents.subtitle.h/2):t.options.misc.canvasPadding.top+t.textComponents.subtitle.h}},l={addTooltips:function(o){var t=o.svg.insert("g").attr("class",o.cssPrefix+"tooltips");t.selectAll("."+o.cssPrefix+"tooltip").data(o.options.data.content).enter().append("g").attr("class",o.cssPrefix+"tooltip").attr("id",function(t,e){return o.cssPrefix+"tooltip"+e}).style("opacity",0).append("rect").attr("rx",o.options.tooltips.styles.borderRadius).attr("ry",o.options.tooltips.styles.borderRadius).attr("x",-o.options.tooltips.styles.padding).attr("opacity",o.options.tooltips.styles.backgroundOpacity).style("fill",o.options.tooltips.styles.backgroundColor),t.selectAll("."+o.cssPrefix+"tooltip").data(o.options.data.content).append("text").attr("fill",function(t){return o.options.tooltips.styles.color}).style("font-size",function(t){return o.options.tooltips.styles.fontSize}).style("font-family",function(t){return o.options.tooltips.styles.font}).text(function(t,e){var n=o.options.tooltips.string;return"caption"===o.options.tooltips.type&&(n=t.caption),l.replacePlaceholders(o,n,e,{label:t.label,value:t.value,percentage:t.percentage})}),t.selectAll("."+o.cssPrefix+"tooltip rect").attr("width",function(t,e){return p.getDimensions(o.cssPrefix+"tooltip"+e).w+2*o.options.tooltips.styles.padding}).attr("height",function(t,e){return p.getDimensions(o.cssPrefix+"tooltip"+e).h+2*o.options.tooltips.styles.padding}).attr("y",function(t,e){return-p.getDimensions(o.cssPrefix+"tooltip"+e).h/2+1})},showTooltip:function(t,e){var n=t.options.tooltips.styles.fadeInSpeed;l.currentTooltip===e&&(n=1),l.currentTooltip=e,d3.select("#"+t.cssPrefix+"tooltip"+e).transition().duration(n).style("opacity",function(){return 1}),l.moveTooltip(t)},moveTooltip:function(n){d3.selectAll("#"+n.cssPrefix+"tooltip"+l.currentTooltip).attr("transform",function(t){var e=d3.mouse(this.parentNode);return"translate("+(e[0]+n.options.tooltips.styles.padding+2)+","+(e[1]-2*n.options.tooltips.styles.padding-2)+")"})},hideTooltip:function(t,e){d3.select("#"+t.cssPrefix+"tooltip"+e).style("opacity",function(){return 0}),d3.select("#"+t.cssPrefix+"tooltip"+l.currentTooltip).attr("transform",function(t,e){return"translate(-1000,-1000)"})},replacePlaceholders:function(t,e,n,o){p.isFunction(t.options.tooltips.placeholderParser)&&t.options.tooltips.placeholderParser(n,o);return e.replace(/\{(\w+)\}/g,function(t){return o.hasOwnProperty(arguments[1])?o[arguments[1]]:t})}};t.prototype.recreate=function(){i(this)&&(c.call(this),u.call(this))},t.prototype.redraw=function(){this.element.innerHTML="",u.call(this)},t.prototype.destroy=function(){this.element.innerHTML="",d3.select(this.element).attr(o,null)},t.prototype.getOpenSegment=function(){var t=this.currentlyOpenSegment;if(null==t)return null;var e=parseInt(d3.select(t).attr("data-index"),10);return{element:t,index:e,data:this.options.data.content[e]}},t.prototype.openSegment=function(t){(t=parseInt(t,10))<0||t>this.options.data.content.length-1||g.openSegment(this,d3.select("#"+this.cssPrefix+"segment"+t).node())},t.prototype.closeSegment=function(){g.maybeCloseOpenSegment(this)},t.prototype.updateProp=function(t,e){switch(t){case"header.title.text":var n=p.processObj(this.options,t);p.processObj(this.options,t,e),d3.select("#"+this.cssPrefix+"title").html(e),(""===n&&""!==e||""!==n&&""===e)&&this.redraw();break;case"header.subtitle.text":n=p.processObj(this.options,t);p.processObj(this.options,t,e),d3.select("#"+this.cssPrefix+"subtitle").html(e),(""===n&&""!==e||""!==n&&""===e)&&this.redraw();break;case"callbacks.onload":case"callbacks.onMouseoverSegment":case"callbacks.onMouseoutSegment":case"callbacks.onClickSegment":case"effects.pullOutSegmentOnClick.effect":case"effects.pullOutSegmentOnClick.speed":case"effects.pullOutSegmentOnClick.size":case"effects.highlightSegmentOnMouseover":case"effects.highlightLuminosity":p.processObj(this.options,t,e);break;default:p.processObj(this.options,t,e),this.destroy(),this.recreate()}};var c=function(){this.options.data.content=d.sortPieData(this),this.options.data.smallSegmentGrouping.enabled&&(this.options.data.content=p.applySmallSegmentGrouping(this.options.data.content,this.options.data.smallSegmentGrouping)),this.options.colors=p.initSegmentColors(this),this.totalSize=d.getTotalPieSize(this.options.data.content);for(var t=this.options.labels.percentage.decimalPlaces,e=0;e<this.options.data.content.length;e++)this.options.data.content[e].percentage=b(this.options.data.content[e].value,this.totalSize,t);for(var n=0,o=0;o<this.options.data.content.length;o++)o===this.options.data.content.length-1&&(this.options.data.content[o].percentage=(100-n).toFixed(t)),n+=parseFloat(this.options.data.content[o].percentage)},u=function(){this.svg=p.addSVGSpace(this),this.textComponents={headerHeight:0,title:{exists:""!==this.options.header.title.text,h:0,w:0},subtitle:{exists:""!==this.options.header.subtitle.text,h:0,w:0},footer:{exists:""!==this.options.footer.text,h:0,w:0}},this.outerLabelGroupData=[],this.textComponents.title.exists&&r.addTitle(this),this.textComponents.subtitle.exists&&r.addSubtitle(this),r.addFooter(this);var n=this;p.whenIdExists(this.cssPrefix+"footer",function(){r.positionFooter(n);var t=p.getDimensions(n.cssPrefix+"footer");n.textComponents.footer.h=t.h,n.textComponents.footer.w=t.w});var t=[];this.textComponents.title.exists&&t.push(this.cssPrefix+"title"),this.textComponents.subtitle.exists&&t.push(this.cssPrefix+"subtitle"),this.textComponents.footer.exists&&t.push(this.cssPrefix+"footer"),p.whenElementsExist(t,function(){var t,e;n.textComponents.title.exists&&(t=p.getDimensions(n.cssPrefix+"title"),n.textComponents.title.h=t.h,n.textComponents.title.w=t.w),n.textComponents.subtitle.exists&&(e=p.getDimensions(n.cssPrefix+"subtitle"),n.textComponents.subtitle.h=e.h,n.textComponents.subtitle.w=e.w),(n.textComponents.title.exists||n.textComponents.subtitle.exists)&&(e=0,n.textComponents.title.exists&&(e+=n.textComponents.title.h,n.textComponents.subtitle.exists&&(e+=n.options.header.titleSubtitlePadding)),n.textComponents.subtitle.exists&&(e+=n.textComponents.subtitle.h),n.textComponents.headerHeight=e),d.computePieRadius(n),d.calculatePieCenter(n),r.positionTitle(n),r.positionSubtitle(n),n.options.misc.gradient.enabled&&g.addGradients(n),g.create(n),h.add(n,"inner",n.options.labels.inner.format),h.add(n,"outer",n.options.labels.outer.format),h.positionLabelElements(n,"inner",n.options.labels.inner.format),h.positionLabelElements(n,"outer",n.options.labels.outer.format),h.computeOuterLabelCoords(n),h.positionLabelGroups(n,"outer"),h.computeLabelLinePositions(n),n.options.labels.lines.enabled&&"none"!==n.options.labels.outer.format&&h.addLabelLines(n),h.positionLabelGroups(n,"inner"),h.fadeInLabelsAndLines(n),n.options.tooltips.enabled&&l.addTooltips(n),g.addSegmentEventHandlers(n)})},b=function(t,e,n){e=t/e;return n<=0?Math.round(100*e):(100*e).toFixed(n)};return t});